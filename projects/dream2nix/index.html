<!DOCTYPE html>
<html lang="en">
  <head>
    <title>
  dream2nix · DavHau - David Hauer
</title>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="color-scheme" content="light dark">




<meta name="author" content="David Hauer">
<meta name="description" content="!!! Warning: dream2nix is unstable software. While simple UX is one of our main focus points, the APIs are still under development. Do expect changes that will break your setup.
Ecosystem stats: Link to heading Funding Link to heading This project was funded through the NGI Assure Fund, a fund established by NLnet with financial support from the European Commission&rsquo;s Next Generation Internet programme, under the aegis of DG Communications Networks, Content and Technology under grant agreement No 957073.">
<meta name="keywords" content="blog,developer,personal">

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="dream2nix"/>
<meta name="twitter:description" content="!!! Warning: dream2nix is unstable software. While simple UX is one of our main focus points, the APIs are still under development. Do expect changes that will break your setup.
Ecosystem stats: Link to heading Funding Link to heading This project was funded through the NGI Assure Fund, a fund established by NLnet with financial support from the European Commission&rsquo;s Next Generation Internet programme, under the aegis of DG Communications Networks, Content and Technology under grant agreement No 957073."/>

<meta property="og:title" content="dream2nix" />
<meta property="og:description" content="!!! Warning: dream2nix is unstable software. While simple UX is one of our main focus points, the APIs are still under development. Do expect changes that will break your setup.
Ecosystem stats: Link to heading Funding Link to heading This project was funded through the NGI Assure Fund, a fund established by NLnet with financial support from the European Commission&rsquo;s Next Generation Internet programme, under the aegis of DG Communications Networks, Content and Technology under grant agreement No 957073." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://DavHau.com/projects/dream2nix/" /><meta property="article:section" content="projects" />
<meta property="article:published_time" content="2023-04-09T00:00:00+00:00" />
<meta property="article:modified_time" content="2023-04-09T00:00:00+00:00" />





<link rel="canonical" href="https://DavHau.com/projects/dream2nix/">


<link rel="preload" href="/fonts/forkawesome-webfont.woff2?v=1.2.0" as="font" type="font/woff2" crossorigin>


  
  
  <link rel="stylesheet" href="/css/coder.min.0fa2dc75ed1b76894ac0e062b10a6c4730daa745096fa120114b290ed8a48788.css" integrity="sha256-D6Lcde0bdolKwOBisQpsRzDap0UJb6EgEUspDtikh4g=" crossorigin="anonymous" media="screen" />






  
    
    
    <link rel="stylesheet" href="/css/coder-dark.min.593028e7f7ac55c003b79c230d1cd411bb4ca53b31556c3abb7f027170e646e9.css" integrity="sha256-WTAo5/esVcADt5wjDRzUEbtMpTsxVWw6u38CcXDmRuk=" crossorigin="anonymous" media="screen" />
  



 




<link rel="icon" type="image/png" href="/img/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/img/favicon-16x16.png" sizes="16x16">

<link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#5bbad5">




<meta name="generator" content="Hugo 0.106.0">





  </head>






<body class="preload-transitions colorscheme-auto">
  
<div class="float-container">
    <a id="dark-mode-toggle" class="colorscheme-toggle">
        <i class="fa fa-adjust fa-fw" aria-hidden="true"></i>
    </a>
</div>


  <main class="wrapper">
    <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="/">
      DavHau - David Hauer
    </a>
    
      <input type="checkbox" id="menu-toggle" />
      <label class="menu-button float-right" for="menu-toggle">
        <i class="fa fa-bars fa-fw" aria-hidden="true"></i>
      </label>
      <ul class="navigation-list">
        
          
            <li class="navigation-item">
              <a class="navigation-link" href="/projects/">Projects</a>
            </li>
          
        
        
      </ul>
    
  </section>
</nav>


    <div class="content">
      
  <section class="container page">
  <article>
    <header>
      <h1 class="title">
        <a class="title-link" href="https://DavHau.com/projects/dream2nix/">
          dream2nix
        </a>
      </h1>
    </header>

    <!-- raw HTML omitted -->
<p>!!! Warning: dream2nix is unstable software. While simple UX is one of our main focus points, the APIs  are still under development. Do expect changes that will break your setup.</p>
<h3 id="ecosystem-stats">
  Ecosystem stats:
  <a class="heading-link" href="#ecosystem-stats">
    <i class="fa fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<!-- raw HTML omitted -->
<h3 id="funding">
  Funding
  <a class="heading-link" href="#funding">
    <i class="fa fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>This project was funded through the <a href="https://nlnet.nl/assure">NGI Assure</a> Fund, a fund established by <a href="https://nlnet.nl/">NLnet</a> with financial support from the European Commission&rsquo;s <a href="https://ngi.eu/">Next Generation Internet</a> programme, under the aegis of DG Communications Networks, Content and Technology under grant agreement No 957073. <strong>Applications are still open, you can <a href="https://nlnet.nl/propose">apply today</a></strong>.</p>
<p>Besides that, the project also receives private funding and support from <a href="https://platonic.systems"><!-- raw HTML omitted --> Platonic.Systems</a>.</p>
<p>If your organization wants to support the project with extra funding in order to add support for more languages or new features, please contact one of the maintainers.</p>
<h2 id="goals">
  Goals
  <a class="heading-link" href="#goals">
    <i class="fa fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>dream2nix focuses on the following aspects:</p>
<ul>
<li>Modularity</li>
<li>Customizability</li>
<li>Maintainability</li>
<li>Nixpkgs Compatibility, by not enforcing IFD (import from derivation)</li>
<li>Code de-duplication across 2nix converters</li>
<li>Code de-duplication in nixpkgs</li>
<li>Risk-free opt-in aggregated fetching (larger <a href="https://nixos.wiki/wiki/Glossary">FODs</a>, less checksums)</li>
<li>Common UI across 2nix converters</li>
<li>Reduce effort to develop new 2nix solutions</li>
<li>Exploration and adoption of new nix features</li>
<li>Simplified updating of packages</li>
</ul>
<p>The goal of this project is to create a standardized, generic, modular framework for automated packaging solutions, aiming for better flexibility, maintainability and usability.</p>
<p>The intention is to integrate many existing 2nix converters into this framework, thereby improving many of the previously named aspects and providing a unified UX for all 2nix solutions.</p>
<h3 id="test-the-experimental-version-of-dream2nix">
  Test the experimental version of dream2nix
  <a class="heading-link" href="#test-the-experimental-version-of-dream2nix">
    <i class="fa fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>(Currently only nodejs and rust packaging is supported)</p>
<ol>
<li>Make sure you use a nix version &gt;= 2.4 and have <code>experimental-features = &quot;nix-command flakes&quot;</code> set.</li>
<li>Navigate to to the project intended to be packaged and initialize a dream2nix flake:
<pre tabindex="0"><code class="language-command" data-lang="command">  cd ./my-project
  nix flake init -t github:nix-community/dream2nix#simple
</code></pre></li>
<li>List the packages that can be built
<pre tabindex="0"><code class="language-command" data-lang="command">  nix flake show
</code></pre></li>
</ol>
<p>Minimal Example <code>flake.nix</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nix" data-lang="nix"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  inputs<span style="color:#f92672">.</span>dream2nix<span style="color:#f92672">.</span>url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;github:nix-community/dream2nix&#34;</span>;
</span></span><span style="display:flex;"><span>  outputs <span style="color:#f92672">=</span> { self<span style="color:#f92672">,</span> dream2nix }:
</span></span><span style="display:flex;"><span>    dream2nix<span style="color:#f92672">.</span>lib<span style="color:#f92672">.</span>makeFlakeOutputs {
</span></span><span style="display:flex;"><span>      systems <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#34;x86_64-linux&#34;</span>];
</span></span><span style="display:flex;"><span>      config<span style="color:#f92672">.</span>projectRoot <span style="color:#f92672">=</span> <span style="color:#e6db74">./.</span>;
</span></span><span style="display:flex;"><span>      source <span style="color:#f92672">=</span> <span style="color:#e6db74">./.</span>;
</span></span><span style="display:flex;"><span>      projects <span style="color:#f92672">=</span> <span style="color:#e6db74">./projects.toml</span>;
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Extensive Example <code>flake.nix</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nix" data-lang="nix"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  inputs<span style="color:#f92672">.</span>dream2nix<span style="color:#f92672">.</span>url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;github:nix-community/dream2nix&#34;</span>;
</span></span><span style="display:flex;"><span>  outputs <span style="color:#f92672">=</span> { self<span style="color:#f92672">,</span> dream2nix }:
</span></span><span style="display:flex;"><span>    dream2nix<span style="color:#f92672">.</span>lib<span style="color:#f92672">.</span>makeFlakeOutputs {
</span></span><span style="display:flex;"><span>      systems <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#34;x86_64-linux&#34;</span>];
</span></span><span style="display:flex;"><span>      config<span style="color:#f92672">.</span>projectRoot <span style="color:#f92672">=</span> <span style="color:#e6db74">./.</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      source <span style="color:#f92672">=</span> <span style="color:#e6db74">./.</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># `projects` can alternatively be an attrset.</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># `projects` can be omitted if `autoProjects = true` is defined.</span>
</span></span><span style="display:flex;"><span>      projects <span style="color:#f92672">=</span> <span style="color:#e6db74">./projects.toml</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># Configure the behavior of dream2nix when translating projects.</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># A setting applies to all discovered projects if `filter` is unset,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># or just to a subset or projects if `filter` is used.</span>
</span></span><span style="display:flex;"><span>      settings <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># prefer aggregated source fetching (large FODs)</span>
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          aggregate <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># for all impure nodejs projects with just a `package.json`,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># add arguments for the `package-json` translator</span>
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>          filter <span style="color:#f92672">=</span> project: project<span style="color:#f92672">.</span>translator <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;package-json&#34;</span>;
</span></span><span style="display:flex;"><span>          subsystemInfo<span style="color:#f92672">.</span>npmArgs <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;--legacy-peer-deps&#34;</span>;
</span></span><span style="display:flex;"><span>          subsystemInfo<span style="color:#f92672">.</span>nodejs <span style="color:#f92672">=</span> <span style="color:#ae81ff">18</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      ];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># configure package builds via overrides</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># (see docs for override system below)</span>
</span></span><span style="display:flex;"><span>      packageOverrides <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># name of the package</span>
</span></span><span style="display:flex;"><span>        package-name <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>          <span style="color:#75715e"># name the override</span>
</span></span><span style="display:flex;"><span>          add-pre-build-steps <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># override attributes</span>
</span></span><span style="display:flex;"><span>            preBuild <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;...&#34;</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># update attributes</span>
</span></span><span style="display:flex;"><span>            buildInputs <span style="color:#f92672">=</span> old: old <span style="color:#f92672">++</span> [pkgs<span style="color:#f92672">.</span>hello];
</span></span><span style="display:flex;"><span>          };
</span></span><span style="display:flex;"><span>        };
</span></span><span style="display:flex;"><span>      };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># Inject missing dependencies</span>
</span></span><span style="display:flex;"><span>      inject <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Make foo depend on bar and baz</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># from</span>
</span></span><span style="display:flex;"><span>        foo<span style="color:#f92672">.</span><span style="color:#e6db74">&#34;6.4.1&#34;</span> <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>          <span style="color:#75715e"># to</span>
</span></span><span style="display:flex;"><span>          [<span style="color:#e6db74">&#34;bar&#34;</span> <span style="color:#e6db74">&#34;13.2.0&#34;</span>]
</span></span><span style="display:flex;"><span>          [<span style="color:#e6db74">&#34;baz&#34;</span> <span style="color:#e6db74">&#34;1.0.0&#34;</span>]
</span></span><span style="display:flex;"><span>        ];
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># dependencies with @ and slash require quoting</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># the format is the one that is in the lockfile</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;@tiptap/extension-code&#34;</span><span style="color:#f92672">.</span><span style="color:#e6db74">&#34;2.0.0-beta.26&#34;</span> <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>           [<span style="color:#e6db74">&#34;@tiptap/core&#34;</span> <span style="color:#e6db74">&#34;2.0.0-beta.174&#34;</span>]
</span></span><span style="display:flex;"><span>         ];
</span></span><span style="display:flex;"><span>      };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># add sources for `bar` and `baz`</span>
</span></span><span style="display:flex;"><span>      sourceOverrides <span style="color:#f92672">=</span> oldSources: {
</span></span><span style="display:flex;"><span>        bar<span style="color:#f92672">.</span><span style="color:#e6db74">&#34;13.2.0&#34;</span> <span style="color:#f92672">=</span> builtins<span style="color:#f92672">.</span>fetchTarball {url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>; sha256 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>;};
</span></span><span style="display:flex;"><span>        baz<span style="color:#f92672">.</span><span style="color:#e6db74">&#34;1.0.0&#34;</span> <span style="color:#f92672">=</span> builtins<span style="color:#f92672">.</span>fetchTarball {url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>; sha256 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>;};
</span></span><span style="display:flex;"><span>      };
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>An example for instancing dream2nix per pkgs and using it to create outputs can be found at <a href="./examples/_d2n-init-pkgs/flake.nix"><code>examples_d2n-init-pkgs</code></a>.</p>
<h3 id="documentation">
  Documentation
  <a class="heading-link" href="#documentation">
    <i class="fa fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>Documentation for <code>main</code> branch is deployed to <a href="https://nix-community.github.io/dream2nix">https://nix-community.github.io/dream2nix</a>.</p>
<p>A CLI app is available if you want to read documentation in your terminal.
The app is available as <code>d2n-docs</code> if you enter the development shell, otherwise you can access it with <code>nix run .#docs</code>.
<code>d2n-docs</code> can be used to access all available documentation.
To access a specific document you can use <code>d2n-docs doc-name</code> where <code>doc-name</code> is the name of the document.
For example, to access Rust subsystem documentation, you can use <code>d2n-docs rust</code>.</p>
<p>You can also build documentation by running <code>nix build .#docs</code>.
Or by entering the development shell (<code>nix develop</code>) and running <code>mdbook build docs</code>.</p>
<h3 id="watch-the-presentation">
  Watch the presentation
  <a class="heading-link" href="#watch-the-presentation">
    <i class="fa fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>(The code examples of the presentation are outdated)
<a href="https://www.youtube.com/watch?v=jqCfHMvCsfQ"><img src="https://gist.githubusercontent.com/DavHau/755fed3774e89c0b9b8953a0a25309fa/raw/3c8b2c56f5fca3bf5c343ffc179136eef39d4d6a/dream2nix-youtube-talk.png" alt="dream2nix - A generic framework for 2nix tools"></a></p>
<h3 id="community">
  Community
  <a class="heading-link" href="#community">
    <i class="fa fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>matrix: <a href="https://matrix.to/#/#dream2nix:nixos.org">https://matrix.to/#/#dream2nix:nixos.org</a></p>

  </article>
</section>

  

    </div>

    <footer class="footer">
  <section class="container">
    ©
    
      1993 -
    
    2023
     David Hauer 
    ·
    
    Powered by <a href="https://gohugo.io/">Hugo</a> & <a href="https://github.com/luizdepra/hugo-coder/">Coder</a>.
    
  </section>
</footer>

  </main>

  

  
  
  <script src="/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js" integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script>
  

  

  


  

  

  

  

  

  

  

  

  

  

  
</body>

</html>
