<!DOCTYPE html>
<html lang="en">
  <head>
    <title>
  nix-portable · DavHau - David Hauer
</title>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="color-scheme" content="light dark">




<meta name="author" content="David Hauer">
<meta name="description" content="Nix as a static executable requiring no configuration, privileges, or (user) namespaces.
For binary downloads check the releases page.
Goals: Link to heading make it extremely simple to install nix make nix work in restricted environments (containers, HPC, &hellip;) be able to use the official binary cache (by simulating the /nix/store) make it easy to distribute nix (via other package managers) Tested on the following systems/environments: Link to heading Distros (x86_64): Arch Linux CentOS 7 Debian Fedora NixOS Ubuntu Distros (aarch64): Debian Other Environments: Docker (debian image) Github Actions Under the hood: Link to heading The nix-portable executable is a self extracting archive, caching its contents in $HOME/.">
<meta name="keywords" content="blog,developer,personal">

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="nix-portable"/>
<meta name="twitter:description" content="Nix as a static executable requiring no configuration, privileges, or (user) namespaces.
For binary downloads check the releases page.
Goals: Link to heading make it extremely simple to install nix make nix work in restricted environments (containers, HPC, &hellip;) be able to use the official binary cache (by simulating the /nix/store) make it easy to distribute nix (via other package managers) Tested on the following systems/environments: Link to heading Distros (x86_64): Arch Linux CentOS 7 Debian Fedora NixOS Ubuntu Distros (aarch64): Debian Other Environments: Docker (debian image) Github Actions Under the hood: Link to heading The nix-portable executable is a self extracting archive, caching its contents in $HOME/."/>

<meta property="og:title" content="nix-portable" />
<meta property="og:description" content="Nix as a static executable requiring no configuration, privileges, or (user) namespaces.
For binary downloads check the releases page.
Goals: Link to heading make it extremely simple to install nix make nix work in restricted environments (containers, HPC, &hellip;) be able to use the official binary cache (by simulating the /nix/store) make it easy to distribute nix (via other package managers) Tested on the following systems/environments: Link to heading Distros (x86_64): Arch Linux CentOS 7 Debian Fedora NixOS Ubuntu Distros (aarch64): Debian Other Environments: Docker (debian image) Github Actions Under the hood: Link to heading The nix-portable executable is a self extracting archive, caching its contents in $HOME/." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://DavHau.com/projects/nix-portable/" /><meta property="article:section" content="projects" />
<meta property="article:published_time" content="2023-04-09T00:00:00+00:00" />
<meta property="article:modified_time" content="2023-04-09T00:00:00+00:00" />





<link rel="canonical" href="https://DavHau.com/projects/nix-portable/">


<link rel="preload" href="/fonts/forkawesome-webfont.woff2?v=1.2.0" as="font" type="font/woff2" crossorigin>


  
  
  <link rel="stylesheet" href="/css/coder.min.0fa2dc75ed1b76894ac0e062b10a6c4730daa745096fa120114b290ed8a48788.css" integrity="sha256-D6Lcde0bdolKwOBisQpsRzDap0UJb6EgEUspDtikh4g=" crossorigin="anonymous" media="screen" />






  
    
    
    <link rel="stylesheet" href="/css/coder-dark.min.593028e7f7ac55c003b79c230d1cd411bb4ca53b31556c3abb7f027170e646e9.css" integrity="sha256-WTAo5/esVcADt5wjDRzUEbtMpTsxVWw6u38CcXDmRuk=" crossorigin="anonymous" media="screen" />
  



 




<link rel="icon" type="image/png" href="/img/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/img/favicon-16x16.png" sizes="16x16">

<link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#5bbad5">




<meta name="generator" content="Hugo 0.106.0">





  </head>






<body class="preload-transitions colorscheme-auto">
  
<div class="float-container">
    <a id="dark-mode-toggle" class="colorscheme-toggle">
        <i class="fa fa-adjust fa-fw" aria-hidden="true"></i>
    </a>
</div>


  <main class="wrapper">
    <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="/">
      DavHau - David Hauer
    </a>
    
      <input type="checkbox" id="menu-toggle" />
      <label class="menu-button float-right" for="menu-toggle">
        <i class="fa fa-bars fa-fw" aria-hidden="true"></i>
      </label>
      <ul class="navigation-list">
        
          
            <li class="navigation-item">
              <a class="navigation-link" href="/projects/">Projects</a>
            </li>
          
        
        
      </ul>
    
  </section>
</nav>


    <div class="content">
      
  <section class="container page">
  <article>
    <header>
      <h1 class="title">
        <a class="title-link" href="https://DavHau.com/projects/nix-portable/">
          nix-portable
        </a>
      </h1>
    </header>

    <!-- raw HTML omitted -->
<p>Nix as a static executable requiring no configuration, privileges, or (user) namespaces.</p>
<p>For binary downloads check the <a href="https://github.com/DavHau/nix-portable/releases">releases</a> page.</p>
<h3 id="goals">
  Goals:
  <a class="heading-link" href="#goals">
    <i class="fa fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<ul>
<li>make it extremely simple to install nix</li>
<li>make nix work in restricted environments (containers, HPC, &hellip;)</li>
<li>be able to use the official binary cache (by simulating the /nix/store)</li>
<li>make it easy to distribute nix (via other package managers)</li>
</ul>
<h3 id="tested-on-the-following-systemsenvironments">
  Tested on the following systems/environments:
  <a class="heading-link" href="#tested-on-the-following-systemsenvironments">
    <i class="fa fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<ul>
<li>Distros (x86_64):
<ul>
<li>Arch Linux</li>
<li>CentOS 7</li>
<li>Debian</li>
<li>Fedora</li>
<li>NixOS</li>
<li>Ubuntu</li>
</ul>
</li>
<li>Distros (aarch64):
<ul>
<li>Debian</li>
</ul>
</li>
<li>Other Environments:
<ul>
<li>Docker (debian image)</li>
<li>Github Actions</li>
</ul>
</li>
</ul>
<h3 id="under-the-hood">
  Under the hood:
  <a class="heading-link" href="#under-the-hood">
    <i class="fa fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<ul>
<li>The nix-portable executable is a self extracting archive, caching its contents in $HOME/.nix-portable</li>
<li>Either bubblewrap or proot is used to simulate the /nix/store directory which actually resides in $HOME/.nix-portable/store</li>
<li>A default nixpkgs channel is included and the NIX_PATH variable is set accordingly.</li>
<li>Features <code>flakes</code> and <code>nix-command</code> are enabled out of the box.</li>
</ul>
<h3 id="drawbacks--considerations">
  Drawbacks / Considerations:
  <a class="heading-link" href="#drawbacks--considerations">
    <i class="fa fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>If user namespaces are not available on a system, nix-portable will fall back to using proot instead of bubblewrap.
Proot&rsquo;s virtualization can have a significant performance overhead depending on the workload.
In that situation, it might be beneficial to use a remote builder or alternatively build the derivations on another host and sync them via a cache like cachix.org.</p>
<h3 id="missing-features">
  Missing Features:
  <a class="heading-link" href="#missing-features">
    <i class="fa fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<ul>
<li>managing nix profiles via <code>nix-env</code></li>
<li>managing nix channels via <code>nix-channel</code></li>
<li>support MacOS</li>
</ul>
<h3 id="executing-nix-portable">
  Executing nix-portable
  <a class="heading-link" href="#executing-nix-portable">
    <i class="fa fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>After obtaining the binary, there are two options:</p>
<ol>
<li>Specify the nix executable via cmdline argument:
<pre tabindex="0"><code>./nix-portable nix-shell ...
</code></pre></li>
<li>Select the nix executable via symlinking, similar to busybox:
<pre tabindex="0"><code># create a symlink from ./nix-shell to ./nix-portable
ln -s ./nix-portable ./nix-shell
# execute nix-shell
./nix-shell
</code></pre></li>
</ol>
<h3 id="executing-installed-programs">
  Executing installed programs
  <a class="heading-link" href="#executing-installed-programs">
    <i class="fa fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>All programs installed via nix-portable will only work inside the wrapped environment.
To enter the wrapped environment just use nix-shell:</p>
<pre tabindex="0"><code>  nix-portable nix-shell -p bash
</code></pre><p>&hellip; or use <code>nix run</code> to execute a program:</p>
<pre tabindex="0"><code>  nix-portable nix run {flake-spec}
</code></pre><h3 id="container-runtimes">
  Container Runtimes
  <a class="heading-link" href="#container-runtimes">
    <i class="fa fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>To simulate the /nix/store and a few other directories, nix-portable supports the following container runtimes.</p>
<ul>
<li>bwrap (existing installation)</li>
<li>bwrap (shipped via nix-portable)</li>
<li>proot (existing installation)</li>
<li>proot (shipped via nix-portable)</li>
</ul>
<p>bwrap is preferred over proot and existing installations are preferred over the nix-portable included binaries.
nix-portable will try to figure out which runtime is best for your system.
In case the automatically selected runtime doesn&rsquo;t work, use the follwing environment variables to specify the runtime, but please also open an issue, so we can improve the automatic selection.</p>
<h3 id="environment-variables">
  Environment Variables
  <a class="heading-link" href="#environment-variables">
    <i class="fa fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>The following environment variables are optional and can be used to override the default behaviour of nix-portable</p>
<pre tabindex="0"><code>NP_DEBUG      (1 = debug msgs; 2 = &#39;set -x&#39; for nix-portable)
NP_GIT        specify path to the git executable
NP_LOCATION   where to put the `.nix-portable` dir. (defaults to `$HOME`)
NP_RUNTIME    which runtime to use (must be &#39;bwrap&#39; or &#39;proot&#39;)
NP_BWRAP      specify the path to the bwrap executable to use
NP_PROOT      specify the path to the proot executable to use
NP_RUN        override the complete command to run nix
              (to use an unsupported runtime, or for debugging)
              nix will then be executed like: $NP_RUN {nix-binary} {args...}
</code></pre><h3 id="building--contributing">
  Building / Contributing
  <a class="heading-link" href="#building--contributing">
    <i class="fa fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>To speed up builds, add the nix-portable cache:</p>
<pre tabindex="0"><code>nix-shell -p cachix --run &#34;cachix use nix-portable&#34;
</code></pre>
  </article>
</section>

  

    </div>

    <footer class="footer">
  <section class="container">
    ©
    
      1993 -
    
    2023
     David Hauer 
    ·
    
    Powered by <a href="https://gohugo.io/">Hugo</a> & <a href="https://github.com/luizdepra/hugo-coder/">Coder</a>.
    
  </section>
</footer>

  </main>

  

  
  
  <script src="/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js" integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script>
  

  

  


  

  

  

  

  

  

  

  

  

  

  
</body>

</html>
